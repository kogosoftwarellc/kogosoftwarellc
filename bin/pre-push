#!/bin/bash

set -e
set -x

PREFIX_TMP_DIR="/tmp/github-pages-"

TMP_DIR="$PREFIX_TMP_DIR`date +%s`"

rm -rf $PREFIX_TMP_DIR*

echo "Current directory: $PWD"
echo "Temp directory $TMP_DIR"

git pull origin src

rm -rf node_modules

npm install

gulp

mv dist $TMP_DIR

rm -rf node_modules

for file in `ls -a`;do
  if [[ "$file" != '.git' && "$file" != '.' && "$file" != '..' ]];then
    rm -rf $file
  fi
done

git checkout master
git pull origin master

cp -R $TMP_DIR/* .

set +x

if [ -n "`git status --porcelain`" ];then
  set -x
  git add -A .
  git commit -m updates
  
  git push origin master
else
  echo 'No updates need to be made!'
fi

set -x

git checkout src
