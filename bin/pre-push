#!/bin/bash

set -e
set -x

PREFIX_TMP_DIR="/tmp/github-pages-"

TMP_DIR="$PREFIX_TMP_DIR`date +%s`"

rm -rf $PREFIX_TMP_DIR*

echo "Current directory: $PWD"
echo "Temp directory $TMP_DIR"

npm install

gulp

mv dist $TMP_DIR
mv node_modules ${PREFIX_TMP_DIR}node_modules
mv src ${PREFIX_TMP_DIR}src

git checkout master
git pull origin master

cp -R $TMP_DIR/* .

set +x

if [ -n "`git status --porcelain`" ];then
  set -x
  git add -A .
  git commit -m updates
  
  git push origin master
else
  echo 'No updates need to be made!'
fi

set -x

git checkout src

mv ${PREFIX_TMP_DIR}node_modules node_modules
mv ${PREFIX_TMP_DIR}src src
